{% extends 'Admin/base_layout.html' %}



{% block content %}
    <!-- Favicon -->
    <link href="/static/img/favicon.ico" rel="icon">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/static/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/static/bootstrap/css/style.css" rel="stylesheet">
    <style>
        .sidebar {
    height: 100vh;
    background-color: green;
    color: white;
    padding-top: 1rem;
}

.sidebar a {
    color: white;
    text-decoration: none;
    display: block;
    padding: 0.75rem 1rem;
}

.sidebar a:hover, .sidebar .active {
    background-color: rgba(0, 0, 0, 0.37);
    border-radius: 0.375rem;
}

.modal-backdrop {
    background-color: rgba(0, 0, 0, 0.5);
}

.table {
    border-collapse: collapse;
    width: 100%;
}

.table th, .table td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
}

.table th {
    background-color: #f0f0f0;
}

.table-striped tbody tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

.table-striped {
    border-collapse: collapse;
    width: 100%;
}

.table-striped th, .table-striped td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
}

.table-striped th {
    background-color: #f0f0f0;
}

.table-striped tr:nth-child(even) {
    background-color: #f9f9f9;
}

    </style>
</head>

<body>
 


        <!-- Sidebar -->
        <nav class="col-md-2 d-none d-md-block sidebar pe-4 pb-3 collapse" id="sidebar">

    <a href="" class="navbar-brand mb-3  ms-2 ps-0">
        <h3 class="text-light">TECTONIC GLOBAL  <br> SERVICES LIMITED </h3>
    </a>
    <div class="d-flex align-items-center ms-4 mb-4">
        <div class="position-relative">
            <img class="rounded-circle" src="/static/images/bimbo.jpeg" alt="" style="width: 40px; height: 40px;">
            <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
        </div>
        <div class="ms-3">
            <h6 class="mb-0">Admin</h6>
            <span>Administrator</span>
        </div>
    </div>
    <div class="navbar-nav w-100">
        <a href="#dashboard" data-link="dashboard" class="nav-item nav-link">
            <i class="fa fa-tachometer me-2"></i>Dashboard</a>
        <a href="" class="nav-item nav-link"><i class="fa fa-users me-2"></i>Users</a>
        
       
            <a href="#testimonials" data-link="testimonials" class="nav-item nav-link"><i class="fa fa-quote-right me-2"></i>Testimonials</a>
            <a href="#services" data-link="services" class="nav-item nav-link"><i class="fa fa-cog me-2"></i>Services</a>
            <a href="#bookings" data-link="bookings" class="nav-item nav-link"><i class="fa fa-book me-2"></i>Bookings</a>
        

    </div>
</nav>



        <!-- Content Start -->
        <div class="content section" data-section="dashboard">

            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
              

                    <strong class="text-success d-md-block ">Admin Dashboard</strong>
                
                
                <div class="navbar-nav align-items-center ms-auto">
                    
                    <div class="nav-item dropdown position-relative">
                        <a href="#" class="nav-link dropdown-toggle" id="notification-link" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notifications</span>
                            {% if notifications %}
                                <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">{{ notifications | length }}</span>
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="notification-link" style="max-height: 300px; overflow-y: auto;">
                            {% if notifications %}
                                {% for notification in notifications %}
                                    <div class="dropdown-item">
                                        <small>{{ notification.message }}</small>
                                    </div>
                                   
                                {% endfor %}
                                <a href="{{ url_for('clear_notifications') }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to clear all notifications?')">
                                    <i class="fa fa-trash"></i> Clear Notifications
                                </a>
                            {% else %}
                                <div class="dropdown-item">
                                    <small>No notifications</small>
                                </div>
                                
                            {% endif %}
                          
                            
                        </div>
                    </div>
                    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <script>
            {% for message in messages %}
                Swal.fire({
                    title: 'Notification',
                    text: '{{ message }}',
                    icon: 'info',
                    timer: 5000,
                    showConfirmButton: false
                });
            {% endfor %}
        </script>
    {% endif %}
{% endwith %}

                   
                    <div class="nav-item ">
                        <a href="#" class="nav-link ">
                            <img class="rounded-circle me-lg-2" src="/static/images/bimbo.jpeg" alt="" style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">Abimbola</span>
                        </a>
                       
                    </div>
                </div>
            </nav>
            <!-- Navbar End -->


         

<!-- Statistics Start -->
<div class="container-fluid pt-4 px-4 section" data-section="dashboard">
    <div class="row g-4">
        <div class="col-sm-6 col-xl-3" id="users">
            <!-- users -->
            <div class="card border-0 rounded d-flex align-items-center justify-content-between p-4" style="background-color: #f0f2f5;">
                <i class="fa fa-users fa-3x text-primary"></i>
                <div class="ms-3">
                    <p class="mb-2">Total Customers</p>
                    <h6 class="mb-0">{{ stats.total_users }} Customers</h6>
                </div>
            </div>
        </div>
        <!-- bookings -->
        <div class="col-sm-6 col-xl-3" id="bookings">
            <div class="card border-0 rounded d-flex align-items-center justify-content-between p-4" style="background-color: #f0f2f5;">
                <i class="fa fa-calendar fa-3x text-success"></i>
                <div class="ms-3">
                    <p class="mb-2">Total Bookings</p>
                    <h6 class="mb-0">{{ stats.total_bookings }} Bookings</h6>
                </div>
            </div>
        </div>
        <!-- testimonials -->
        <div class="col-sm-6 col-xl-3" id="testimonials">
            <div class="card border-0 rounded d-flex align-items-center justify-content-between p-4" style="background-color: #f0f2f5;">
                <i class="fa fa-quote-left fa-3x text-info"></i>
                <div class="ms-3">
                    <p class="mb-2">Total Testimonial</p>
                    <h6 class="mb-0">{{ stats.total_testimonial }} Testimonials</h6>
                </div>
            </div>
        </div>
        <!-- services -->
        <div class="col-sm-6 col-xl-3" id="services">
            <div class="card border-0 rounded d-flex align-items-center justify-content-between p-4" style="background-color: #f0f2f5;">
                <i class="fa fa-cog fa-3x text-warning"></i>
                <div class="ms-3">
                    <p class="mb-2"> Total Services Offered</p>
                    <h6 class="mb-0">{{ stats.total_services }} Services</h6>
                </div>
            </div>
        </div>
       
       
    </div>
</div>


<!-- Statistics End -->


            
<!-- Testimonials Table Start -->
<div class="container-fluid pt-4 px-4 section" data-section="services" id="testimonials">
    <h1 class="mt-4" style="color: #2c3e50;">Testimonials</h1>
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>Quote</th>
                <th>Author</th>
                <th>Rating</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for testimonial in testimonials %}
            <tr>
                <td>{{ testimonial.quote|truncate(20) }}</td>
                <td>{{ testimonial.author }}</td>
                <td>{{ testimonial.rating }} stars</td>
                <td>{{ testimonial.status }}</td>
                <td>
                    
                    
{% if testimonial.status == 'pending' %}
<a href="#" onclick="approveTestimonial({{ testimonial.id }}, '{{ testimonial.quote }}', '{{ testimonial.author }}', {{ testimonial.rating }})">Approve</a>
<a href="#" onclick="rejectTestimonial({{ testimonial.id }}, '{{ testimonial.quote }}', '{{ testimonial.author }}', {{ testimonial.rating }})">Reject</a>
{% elif testimonial.status == 'approved' %}
<span class="text-success" >Approved</span> | 
<a href="#" onclick="rejectTestimonial({{ testimonial.id }}, '{{ testimonial.quote }}', '{{ testimonial.author }}', {{ testimonial.rating }})">Reject</a>
{% elif testimonial.status == 'rejected' %}
<span class="text-danger">Rejected</span> | 
<a href="#" onclick="approveTestimonial({{ testimonial.id }}, '{{ testimonial.quote }}', '{{ testimonial.author }}', {{ testimonial.rating }})">Approve</a>
{% endif %}

<script>
function approveTestimonial(id, quote, author, rating) {
    Swal.fire({
        title: 'Approve Testimonial?',
        html: `
            <b>Testimonial Details:</b>
            <p><b>Quote:</b> '${quote}'</p>
            <p><b>Author:</b> ${author}</p>
            <p><b>Rating:</b> ${rating} stars</p>
            <p>Are you sure you want to approve this testimonial?</p>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes',
        cancelButtonText: 'No'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = "{{ url_for('approve_testimonial', testimonial_id=-1) }}".replace('-1', id);
        }
    });
}

function rejectTestimonial(id, quote, author, rating) {
    Swal.fire({
        title: 'Reject Testimonial?',
        html: `
            <b>Testimonial Details:</b>
            <p><b>Quote:</b> '${quote}'</p>
            <p><b>Author:</b> ${author}</p>
            <p><b>Rating:</b> ${rating} stars</p>
            <p>Are you sure you want to reject this testimonial?</p>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes',
        cancelButtonText: 'No'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = "{{ url_for('delete_testimonial', testimonial_id=-1) }}".replace('-1', id);
        }
    });
}
</script>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<div class="container-fluid " >
    <div class="row">
        <div class="col-md-12">
            <h1 class="mt-4" style="color: #2c3e50;">Services</h1>
            {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            {% for category, message in messages %}
                {% if category == 'success' %}
                    Swal.fire({
                        icon: 'success',
                        title: '{{ message }}',
                        timer: 3000,
                        showConfirmButton: false
                    })
                {% elif category == 'error' %}
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: '{{ message }}',
                    })
                    {%else%}
                    Swal.fire({
                        icon: '{{category}}',
                        title: '{{category}}',
                        text: '{{ message }}',
                    })
                {% endif %}
            {% endfor %}
        </script>
    {% endif %}
{% endwith %}




            <button type="button" class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#addServiceModal">
                <i class="fas fa-plus"></i> Add Service
            </button>
            
            <table class="table table-striped mt-3 section" data-section="testimonials" id="services">
                <thead>
                    <tr>
                        <th>Service Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Category</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                    <tr>
                        <td>{{ service.name }}</td>
                        <td>{{ service.description[:50] }}...</td>
                        <td>{{ service.price }} -- {{service.maxprice}}</td>
                        <td>{{ service.category.name }}</td>
                        <td>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editServiceModal{{ service.id }}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteServiceModal{{ service.id }}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewServiceModal{{ service.id }}">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Service Modal -->
<div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="background-color: #2c3e50; color: #fff;">
                <h5 class="modal-title" id="addServiceModalLabel">Tectonic Global Services Limited</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="color: #fff;"></button>
            </div>
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data" action="{{ url_for('admin') }}">
                    {{ form.hidden_tag() }}
                    <div class="form-group">
                        {{ form.name.label }}
                        {{ form.name(class="form-control", placeholder='Enter Service Name') }}
                    </div>
                    <div class="form-group">
                        {{ form.description.label }}
                        {{ form.description(class="form-control", placeholder='Enter Service Description') }}
                    </div>
                    <div class="form-group">
                        {{ form.price.label }}
                        {{ form.price(class="form-control", placeholder='Enter Minimum Service Price') }}
                    </div>
                    <div class="form-group">
                        {{ form.maxprice.label }}
                        {{ form.maxprice(class="form-control", placeholder='Enter Maximum Service Price') }}
                    </div>
                    <br>
                    <select class="form-control" name="category_id">
                        {% if form.category_id.choices %}
                        <option value="">Select a category</option>
                            {% for choice in form.category_id.choices %}
                            
                                <option value="{{ choice[0] }}">{{ choice[1] }}</option>
                            {% endfor %}
                        {% else %}
                            <option>No categories found</option>
                        {% endif %}
                    </select>
                    <div class="form-group">
                        {{ form.image.label }}
                        {{ form.image(class="form-control") }}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color: #95a5a6; border-color: #95a5a6;">Close</button>
                        <button type="submit" class="btn btn-primary" style="background-color: #34C759; border-color: #34C759;">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>






<!-- Delete Service Modal -->
{% for service in services %}
<div class="modal fade" id="deleteServiceModal{{ service.id }}" tabindex="-1" aria-labelledby="deleteServiceModalLabel{{ service.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="background-color: #2c3e50; color: #fff;">
                <h5 class="modal-title" id="deleteServiceModalLabel{{ service.id }}">Delete Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="color: #fff;"></button>
            </div>
            <div class="modal-body">
                <p class="text-dark">Are you sure you want to delete <strong class="text-danger">{{ service.name }}</strong>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color: #95a5a6; border-color: #95a5a6;">Close</button>
                <a href="{{ url_for('delete_service', service_id=service.id) }}" class="btn btn-danger" style="background-color: #e74c3c; border-color: #e74c3c;">Delete</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- View Service Offcanvas -->
{% for service in services %}
<div class="modal fade" id="viewServiceModal{{ service.id }}" tabindex="-1" aria-labelledby="viewServiceModalLabel{{ service.id }}" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header about">
                <h5 class="modal-title" id="viewServiceModalLabel{{ service.id }}">{{ service.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-success">
                <h2>Service Details</h2>
                <p><strong>Description:</strong> {{ service.description }}</p>
                <p><strong>Price:</strong> {{ service.price }}</p>
                <img src="{{ url_for('static', filename='images/' + service.image) }}" alt="Service Image" style="width:100%; height:300px;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}


<!-- Edit Service Modal -->
{% for service in services %}
<div class="modal fade" id="editServiceModal{{ service.id }}" tabindex="-1" aria-labelledby="editServiceModalLabel{{ service.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="background-color: #2c3e50; color: #fff;">
                <h5 class="modal-title" id="editServiceModalLabel{{ service.id }}">Edit Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="color: #fff;"></button>
            </div>
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data" action="{{ url_for('edit_service', service_id=service.id) }}">
                    {{ edit_form.hidden_tag() }}
                    {{ edit_form.name.label }} 
                    {{ edit_form.name(class="form-control", value=service.name) }}
                    {{ edit_form.description.label }} 
                    <textarea class="form-control" name="description">{{ service.description }}</textarea>
                    {{ edit_form.price.label }} {{ edit_form.price(class="form-control", value=service.price) }}
                   
                    <div class="form-group">
                        {{ edit_form.maxprice.label }}
                        {{ edit_form.maxprice(class="form-control", value=service.maxprice) }}
                    </div>
                    
                    
                    
                    {{ edit_form.image.label }}
                    <input type="file" class="form-control" name="image" id="image{{ service.id }}" onchange="document.getElementById('file-chosen{{ service.id }}').innerHTML = this.files[0].name; document.getElementById('image-preview{{ service.id }}').src = window.URL.createObjectURL(this.files[0]);">
                    <span id="file-chosen{{ service.id }}">{{ service.image }}</span>
                    <img id="image-preview{{ service.id }}" src="{{ url_for('static', filename='images/' + service.image) }}" alt="Service Image" style="width: 100px; height: 100px;">
                
                
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color: #95a5a6; border-color: #95a5a6;">Close</button>
                        <button type="submit" class="btn btn-primary" style="background-color: #34C759; border-color: #34C759;">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>




<script>
    document.getElementById('image').addEventListener('change', function() {
        if (this.files.length > 0) {
            document.getElementById('file-chosen').innerHTML = this.files[0].name;
        } else {
            document.getElementById('file-chosen').innerHTML = '{{ service.image }}';
        }
    });
   


</script>

{% endfor %}


<div class="section" data-section="bookings" id="bookings">
    <h1>Bookings</h1>
    {% if bookings %}
    <a href="{{ url_for('clear_bookings') }}" class="btn btn-danger" onclick="return 
    confirm('Are you sure you want to clear all bookings?')">
        <i class="fa fa-trash"></i> Clear Bookings
    </a>
    {%else%}
    <div class="dropdown-item">
        <small class="alert alert-success"> No Bookings</small>
    </div>
   
    



</div>
</div>
{%endif%}
{% with messages = get_flashed_messages() %}
{% if messages %}
<script>
{% for message in messages %}
Swal.fire({
title: 'Booking',
text: '{{ message }}',
icon: 'info',
timer: 5000,
showConfirmButton: false
});
{% endfor %}
</script>
{% endif %}
{% endwith %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>S/N</th>
                <th>Customer Name</th>
                <th>Customer Email</th>
               <th>Service Name</th>
                <th>Service Price</th>
                <th>Booking Date</th>
                
            </tr>
        </thead>
        <tbody>
            {% for booking in bookings %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ booking.user.name }}</td>
                <td>{{ booking.user.email }}</td>
                <td>{{ booking.service.name }}</td>
                <td>{{ booking.service.price }}</td>
                <td>{{ booking.booking_date }}</td>
               
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>






 

 


           


          
        <!-- Content End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>



    <script src="/static/bootstrap/js/bootstrap.bundle.js"></script>
                 
                                  
    <script src="js/scripts.js"></script>
    
 
    <!-- Template Javascript -->
    <script src="/static/bootstrap/js/main.js" type="a98f71f5c0818dd378239742-text/javascript"></script>
<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="a98f71f5c0818dd378239742-|49" defer></script></body>
<script>
    // Get all sections
const sections = document.querySelectorAll('.section');

// Get all sidebar links
const sidebarLinks = document.querySelectorAll('.sidebar .nav-item');

// Function to update active sidebar link
function updateActiveLink() {
let currentSection = '';

sections.forEach((section) => {
const sectionTop = section.offsetTop;
const sectionBottom = sectionTop + section.offsetTop + section.offsetHeight;

if (window.scrollY >= sectionTop && window.scrollY < sectionBottom) {
  currentSection = section.getAttribute('data-section');
}
});

sidebarLinks.forEach((link) => {
link.classList.remove('active');

if (link.getAttribute('data-link') === currentSection) {
  link.classList.add('active');
}
});
}

// Add event listener to window scroll
window.addEventListener('scroll', updateActiveLink);
</script>

      
      
{% endblock %}